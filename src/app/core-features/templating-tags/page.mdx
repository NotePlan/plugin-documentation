import Callout from '@/components/Callout'

import { CodeGroup, Code } from '@/components/Code'

# Template Tags

`Templating` uses a tagging system to indicate where dynamic content will be generated within template notes.

## Tags

A Template tag contains a starting/opening tag and an ending/closing tag.

### Opening Tags

- `<%-` Outputs the value into the template
- `<%` Script tag to be used when executing any JavaScript command without producing any output
- `<%#` Comment tag, no execution, no output
- `<%=` HTML output tag, escapes HTML characters in the output (e.g. `<` becomes `&lt;`) -- generally not used in NotePlan and not recommended -- use `<%-` instead

## Closing Tags

- `%>` Plain ending tag - used when you want to keep the return at the end of the line (true for most content insertion)
- `-%>` 'Whitespace Slurping' Template tag, strips all whitespace after it ([example](#strip-whitespace)) -- generally every code tag should have this at the end of the line so that the return on the line is not included in the output.

## Output Tags

This is the most often used tag. When you wish to output anything to the rendered template, you use the output `<%-` tag.

## Examples

The following are various examples of `Templating` tags in action

### Simple Date Output

This example shows how to output the current date and time in the format `YYYY-MM-DD HH:mm`. Outputs the line and keep the return at the end of the line.

~~~markdown
<%- date.now('YYYY-MM-DD HH:mm') %>
~~~

### Simple Output with Two Variables in the Same Line

This example shows how to output the current date and time in the format `YYYY-MM-DD HH:mm` and the current day of the week in the format `dddd` separated by a space (because of the space between the two tags).

~~~markdown
<%- date.now('YYYY-MM-DD HH:mm') %> <%- date.dayName() %>
~~~

### JavaScript / Flow Control Tag

The basic flow control tag `<%` is used when you want to perform a standard JavaScript action such as setting a variable, doing a calculation, [looping](/docs/templating-examples/looping) or [conditionals](/docs/templating-examples/conditional). In this example, a `date.now()` method would be called, but the actual output would be displayed in another section of template. This example shows a single line of JavaScript, but if you have many lines of code, you may want to use the [templatejs code block](#templatejs-code-block) instead.

~~~markdown
<% const nowIs = date.now() // the variable is set in this tag -%>
...
<%- nowIs %>
~~~
^^^ The variable is set at the top, but the output is placed later in the template using a simple output tag (`<%-`) with the variable name.

<Callout type="warning">
Note that control/code tags, like any text, are on a line by themselves. This means there is a return at the end of the line. When the template is rendered, the tag will be processed and deleted, but the return at the end of the line will show up in your rendered template as a blank line. 
</Callout>

So, in the example above, the actual output would be:
~~~markdown
...
2025-02-02 <-- the output line with a return after
~~~

If you don't want returns at the end of the line, use the minus (`-%>` slurping tag) at the end of each Javascript or flow control line (as you see in the example above), e.g.
~~~markdown
<% const myVar = note.title // there will be no blank line when this is processed because of the dash: -%>
~~~
This will remove the return at the end of the line with the `const data`, so the output in this case would be just the date with no extra blank lines.

### Standard output tag (variable)

Display `first` name variable contained in `Templating` [Plugin Settings](/docs/settings)

~~~markdown
<%- user.first %>
~~~

### Standard output tag (module method)

Displays current date from [Date Module](/docs/templating-modules/date-module)

<Code language="markdown">
{`<%- date.now() %>`}
</Code>


### templatejs Code Block

To make coding in templates easier, you can add a code block with the language "templatejs", and use all the variables that are generated in this code block inside your template. You can use JavaScript in this code block and have full access to the [JavaScript Plugin API](https://help.noteplan.co/article/70-javascript-plugin-api) and templating modules.

For example:

~~~markdown
---
title: Overdue Tasks
type: meeting-note
---
```templatejs

// this is a big block of JavaScript code that is wrapped in a code block 
// with the language "templatejs"

// Get all overdue tasks
const overdues = await DataStore.listOverdueTasks()

// Get the overdue task count
const overdueCount = overdues.length

// Get the latest overdue task
const latestTask = overdueCount > 0 ? overdues[0] : null

// create a variable that holds the content if there is a latest task; 
// we define this variable in the code block but use it later in the template
let taskContent = ''
if (latestTask) {
  taskContent = latestTask.rawContent
}
```

Results:
Overdue Tasks: <%- overdueCount %>
<%- taskContent %>
~~~

This will print the amount of overdue tasks and the latest overdue task below.

[Learn here](https://help.noteplan.co/article/148-run-javascript-code-in-your-templates) about how you can use JavaScript in general in your templates, and if you don't have that many lines of code (means you don't need a code block).

### Ignoring Code Blocks

The `template: ignore` feature allows you to mark code blocks in templates to prevent them from being processed by the templating engine. There are two different syntaxes that behave differently:

1. **First-line directive** - Completely removes the code block from the template
2. **Comment-style ignore** - Protects the code block during processing but includes it in the final output

#### First-Line Directive (Complete Removal)

**Syntax:** Place <code>template: ignore</code> as the first line inside a code block (after the opening backticks)

**Behavior:** The entire code block, including the newline that follows it, is completely removed from the template before processing. It will not appear in the final rendered output.

**Supported variations** (the pattern matching allows for flexible whitespace):
- <code>template: ignore</code> (no spaces around colon)
- <code> template: ignore</code> (space before)
- <code>template:ignore</code> (no space after colon)
- <code>  template:  ignore</code> (multiple spaces)

**Example:**

~~~markdown
Some text before the block.

```template: ignore
This entire block will be removed
and will not appear in the final output.
```

Some text after the block.
~~~

**Rendered output:**

```
Some text before the block.

Some text after the block.
```

#### Comment-Style Ignore (Protected During Processing)

**Syntax:** <code>// template: ignore</code> or <code>/* template: ignore */</code> (anywhere in the code block)

**Behavior:** The code block is temporarily protected during template processing (replaced with a placeholder) and then restored in the final output. This is useful when you have code examples or documentation that should appear in the output but should not be processed by the templating engine.

**Example:**

~~~markdown
Here's a code example:

```javascript
// template: ignore
const example = "This code won't be processed";
console.log(example);
```
~~~

**Rendered output:**

~~~markdown
Here's a code example:

```javascript
// template: ignore
const example = "This code won't be processed";
console.log(example);
```
~~~

#### Use Cases

**First-Line Directive Use Cases:**
- **Template metadata or configuration** that should not appear in the rendered output
- **Development notes** or instructions for template authors
- **Processing instructions** that are only relevant during template creation

**Comment-Style Ignore Use Cases:**
- **Code examples** in documentation that should appear in the final output
- **Sample code snippets** that demonstrate how to use the templating system
- **Reference implementations** that users should see but not execute

<Callout type="info">
**Important Notes:**

1. **Pattern matching is strict**: For first-line directives, the pattern must match the first line exactly (with optional whitespace). If <code>template: ignore</code> appears anywhere else in the block (not as a comment), it will not be matched.

2. **Comment-style ignores work anywhere**: Comment-style ignores (<code>// template: ignore</code> or <code>/* template: ignore */</code>) can appear anywhere in the code block, not just the first line.

3. **First-line directive removes everything**: When using the first-line directive, the entire code block including any trailing newline is removed. Be careful not to accidentally remove important whitespace.

4. **Comment-style ignores preserve content**: Comment-style ignores protect the block during processing but restore it exactly as written in the final output.
</Callout>

#### Examples

**Example 1: Removing a Processing Instruction**

~~~markdown
---
title: My Template
---

```template: ignore
This is a note for template authors.
It won't appear in the final output.
```

The actual template content starts here.
~~~

**Example 2: Protecting Code Examples**

~~~markdown
Here's how to use the date module:

```javascript
// template: ignore
const today = date.now();
console.log(today);
```

This code example will appear in the output.
~~~

**Example 3: Mixed Usage**

~~~markdown
Some content.

```template: ignore
This block will be removed.
```

More content.

```javascript
// template: ignore
This block will be protected but appear in output.
```

Even more content.
~~~

### Important Note on Whitespace

When you have have control/process tags, it is recommended that you always use the `Whitespace Slurping` tags at the end of the line. Generally speaking, any control/process tag (`<% ...`) should have a whitespace slurping tag at the end of the line (`-%>`  ). It is very rare that you would want to have a control tag without removing the newline at the end of the line it's on. This is one of the most common mistakes people make when writing templates -- they end up with a lot of blank lines in their output and they don't know why.

<Code language="markdown">
{`<% const testName = 'Mike' -%>
name: <%- testName %>`}
</Code>

will produce the following output

<Code language="markdown">
{`name: Mike`}
</Code>

Look at the following example:

~~~markdown
if (dayNum === 6) { %>
+ 10:00 - 10:30 üèä‚Äç‚ôÄÔ∏è Steph's swimming lesson
<% }  -%>`}
~~~

The output of this code block would be:

~~~markdown
<blank line where the if line was>
16:30 - 17:00 üß† Review my day and plan tomorrow
~~~

The "daynum === 6" line does not have the whitespace slurping tag, so it will have a blank line after it.

The fix is to add the whitespace slurping tag to the "daynum === 6" line, so it looks like this:

~~~markdown
if (dayNum === 6) { -%>
+ 10:00 - 10:30 üèä‚Äç‚ôÄÔ∏è Steph's swimming lesson
<% }  -%>
~~~

<Callout type="warning">
  WARNING: Even though you have access to NotePlan API's like `Editor`, it is generally a bad idea to try to change the contents of the Editor directly during a template run. Using `Editor.insert*` or `Editor.append*` type commands can confict with the running and output of the template. So generally the way to insert content is to use Javascript to generate the content, and then use the output tag to display it where you want it.
</Callout>